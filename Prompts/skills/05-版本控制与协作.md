# 技能：版本控制与协作

## 核心原则

> **小步快跑，频繁提交**：每完成一个独立功能就提交，便于回滚和追溯。

---

## 一、Git 工作流

### 1.1 基本操作频率

| 操作 | 时机 | 频率 |
|------|------|------|
| `git add .` | 完成一个小改动后 | 每 10-30 分钟 |
| `git commit` | 完成一个独立功能后 | 每 1-2 小时 |
| `git push` | 完成一个阶段后 | 每天至少 1 次 |

### 1.2 Commit 信息规范

```
<类型>: <简短描述>

[可选的详细描述]
```

**类型**:
- `feat`: 新功能 (新增笔记内容)
- `fix`: 修复 (修复链接、错误)
- `docs`: 文档 (README 更新)
- `style`: 格式 (排版调整)
- `refactor`: 重构 (结构调整)
- `chore`: 杂项 (脚本、配置)

**示例**:
```bash
git commit -m "feat: Add Lecture 10 Speculative Decoding notes"
git commit -m "fix: Fix broken image links in Lecture 10"
git commit -m "docs: Update README with Lecture 10 summary"
```

---

## 二、笔记项目的 Git 策略

### 2.1 目录 .gitignore

```gitignore
# 临时文件
*.tmp
*.bak
*~

# 编辑器配置
.vscode/
.idea/
*.swp

# 大型原始文件 (可选)
*.mp3
*.mp4
*.pdf

# Python
__pycache__/
*.pyc
.env

# OS
.DS_Store
Thumbs.db
```

### 2.2 敏感内容处理

如果有不想提交的个人笔记:
```bash
# 创建个人笔记目录
mkdir -p NoteByHuman/Personal

# 添加到 .gitignore
echo "NoteByHuman/Personal/" >> .gitignore
```

### 2.3 大文件处理

对于 PDF、视频等大文件:

**选项 A**: 不提交，放 `.gitignore`
```gitignore
# 原始课程材料
Lecture-PDFs/
Course-Videos/
```

**选项 B**: 使用 Git LFS
```bash
git lfs install
git lfs track "*.pdf"
git lfs track "*.mp4"
```

---

## 三、分支策略 (可选)

### 简单项目 (推荐)
```
main ← 所有改动直接提交到 main
```

### 需要实验的项目
```
main ← 稳定版本
  ↑
feature/lecture-10 ← 正在写的新笔记
```

```bash
# 创建分支
git checkout -b feature/lecture-10

# 写完后合并
git checkout main
git merge feature/lecture-10
git branch -d feature/lecture-10
```

---

## 四、回滚与恢复

### 4.1 查看历史
```bash
# 查看最近 10 次提交
git log --oneline -10

# 查看某文件的修改历史
git log --oneline -- "NoteByHuman/Lecture10/Lecture10-Main.md"
```

### 4.2 恢复文件
```bash
# 恢复某文件到上一个版本
git checkout HEAD~1 -- "path/to/file.md"

# 恢复某文件到特定 commit
git checkout abc1234 -- "path/to/file.md"
```

### 4.3 撤销操作
```bash
# 撤销最近一次 commit (保留改动)
git reset --soft HEAD~1

# 撤销最近一次 commit (丢弃改动) ⚠️ 危险
git reset --hard HEAD~1
```

---

## 五、协作场景

### 5.1 多设备同步
```bash
# 设备 A: 完成工作后
git add .
git commit -m "feat: Complete Lecture 10 morning session"
git push

# 设备 B: 开始工作前
git pull
```

### 5.2 处理冲突
```bash
# 拉取时发现冲突
git pull
# Auto-merging file.md
# CONFLICT (content): Merge conflict in file.md

# 手动编辑冲突文件，解决冲突标记
# <<<<<<< HEAD
# 本地内容
# =======
# 远程内容
# >>>>>>> origin/main

# 标记为已解决
git add file.md
git commit -m "resolve: Merge conflict in file.md"
```

---

## 六、自动化脚本

### 6.1 快速提交脚本

创建 `scripts/quick-commit.sh`:
```bash
#!/bin/bash
# 快速提交所有改动

if [ -z "$1" ]; then
    echo "Usage: ./quick-commit.sh 'commit message'"
    exit 1
fi

git add .
git commit -m "$1"
echo "✅ Committed: $1"
```

### 6.2 每日备份脚本

创建 `scripts/daily-backup.sh`:
```bash
#!/bin/bash
# 每日备份提交

DATE=$(date +%Y-%m-%d)
git add .
git commit -m "chore: Daily backup $DATE"
git push
echo "✅ Backed up on $DATE"
```

---

## 七、检查点工作流

### 7.1 创建检查点
在做重大改动前:
```bash
# 创建标签作为检查点
git tag checkpoint-before-refactor
git push --tags
```

### 7.2 回到检查点
如果改动失败:
```bash
# 回到检查点
git checkout checkpoint-before-refactor

# 或创建一个新分支从检查点开始
git checkout -b fresh-start checkpoint-before-refactor
```

---

## 八、最佳实践总结

1. **提交要原子化**: 一个 commit 做一件事
2. **信息要有意义**: 不要写 "update" "fix"
3. **推送前先拉取**: 避免冲突
4. **重要改动先备份**: 用 tag 或分支
5. **定期清理**: 删除无用分支和文件
6. **.gitignore 先行**: 项目开始就配置好

---

## 九、常用 Git 命令速查

```bash
# 状态查看
git status              # 查看工作区状态
git diff               # 查看未暂存的改动
git log --oneline -10  # 查看最近 10 次提交

# 基本操作
git add .              # 暂存所有改动
git commit -m "msg"    # 提交
git push               # 推送到远程
git pull               # 拉取远程更新

# 分支操作
git branch             # 列出分支
git checkout -b name   # 创建并切换分支
git merge branch       # 合并分支

# 撤销操作
git checkout -- file   # 撤销文件修改
git reset HEAD file    # 取消暂存
git reset --soft HEAD~1 # 撤销最近提交 (保留改动)

# 远程操作
git remote -v          # 查看远程仓库
git fetch              # 获取远程更新 (不合并)
```
